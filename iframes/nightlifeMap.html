<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1" charset="utf-8">
  <title>DC Nightlife Map</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link href='https://fonts.googleapis.com/css?family=Neuton:400,700' rel='stylesheet' type='text/css'>

  <link href='../CSS/main.css' rel='stylesheet' type='text/css'>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.20.1/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.20.1/mapbox-gl.css' rel='stylesheet' />
    

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65753381-1', 'auto');
  ga('send', 'pageview');
  </script>

<style>
body { margin:0; padding:0; }
@media (min-width: 0px) and (max-width: 768px){
  #map {  width:100%; height:500px; margin:auto;}
  }
@media (min-width: 768px) {
  #map {  width:100%; height:500px; margin:auto;}
  }

#sidebar {
    position: absolute;
    top: 350px;
    left: 80px;
    bottom: 70px;
    width: 180px;
    overflow: auto;
    font-family: "Arial";
    padding-left: 10px;
    z-index: 10;
    text-align:left ;
    font-size: 16px;
    background: rgba(240, 240, 240, 0.5);
    font-family: 'Neuton', serif;
        }
</style>
</head>

  <body>
  <div id="title">
<p class='graph-title'>DC Nightlife Moving East</p>
<p class='graph-subtitle'>Percent of nightlife opened after 2010</p>
</div>

    <div id='sidebar'>
    <p >Nightlife opened<br>after 2010 (%)</p>
    <span class="legend" style='background:#ffffb2;'>20%</span>
    <span class="legend" style='background:#fecc5c;'>40%</span>
    <span class="legend" style='background:#fd8d3c;'>60%</span>
    <span class="legend" style='background:#f03b20;'>80%</span>
    <span class="legend" style='background:#bd0026;'>100%</span>
    <div id="tooltip-name"></div>
    <div id='tooltip'></div>
    </div>



  <div id="map" class="content"></div>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiZGF0YWxlbnNkYyIsImEiOiJjaWVnOGttYnMwMDBqc2htM2ZmcjZ4NmZxIn0.9iGQPNKsl1jtP5KriDm3wQ';
  
 var COLORS =  ['#f0f0f0','#ffffb2','#fecc5c','#fd8d3c','#f03b20','#bd0026'],
    BREAKS = [0.00001, 0.2, 0.4, 0.6, 0.8, 1.0],
    FILTERUSE;

var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/datalensdc/ciq9yplgq0004c8m4yry64ltu', 
    center: [-77.0369,38.9072], 
    zoom: 11
});


map.addControl(new mapboxgl.Navigation());

map.on('load', function () {
            map.addSource('restOpenHoodGeo', {
                type: 'geojson',
                data: 'https://raw.githubusercontent.com/katerabinowitz/DC-FoodandDrink/master/nightlifeGeoChanges/dataOut/restOpenHoodGeo.geojson'
            });

            map.addLayer({
                "id": "hoods",
                "type": "fill",
                "source": "restOpenHoodGeo",
                "paint": {
                    "fill-color": {
                        property: 'post10',
                        stops: [
                    [BREAKS[0], COLORS[0]],
                    [BREAKS[1], COLORS[1]],
                    [BREAKS[2], COLORS[2]],
                    [BREAKS[3], COLORS[3]],
                    [BREAKS[4], COLORS[4]],
                    [BREAKS[5], COLORS[5]]]
                    },
                    "fill-opacity": 0.7,
                    "fill-outline-color": "#f0f0f0"
                }
            });
             })
map.on("mousemove", function (e) {
            var features = map.queryRenderedFeatures(e.point, {
                layers: ["hoods"]
            });

            if (features.length) {
              if (features[0].properties.post10>0) { 
                document.getElementById('tooltip-name').innerHTML = features[0].properties.NAME;
                document.getElementById('tooltip').innerHTML = Math.round(features[0].properties.post10*100) + "%";
              }
              else { 
                document.getElementById('tooltip-name').innerHTML = features[0].properties.NAME;
                document.getElementById('tooltip').innerHTML = Math.round(features[0].properties.post10*100);
              }
            } else {
                document.getElementById('tooltip-name').innerHTML = "";
                document.getElementById('tooltip').innerHTML = "";
            }
        });
</script>
<p class='graph-subtitle'>Only neighborhoods with 10 or more nightlife establishments shown. Data as of December 2015<br>Source: District of Columbia Open Data; Yelp</p>
</body>
</html>
